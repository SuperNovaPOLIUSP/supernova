{% extends 'base_supernova.html' %}

{% load static %}

{% block title %}<title>Supernova - Generator</title>{% endblock %}

{% block content %}
<div id="center-box">
	<h2 id="h2-spacing"> Gerador de relatórios </h2>

<div id = 'options' style='position:absolute; top:75; left:300'>
    <span>Gerar por: </span>
    <br><br><br>
    <select id = 'ClassNumberOrProfessor' style="width:120px">
        <option value = 2>Class number</option>
        <option value = 1>Professor</option>
    </select>
    
    <select id = 'useProfessorsName' style="width:177px">
        <option value = 1>with professor's name</option>
        <option value = 2>without professor's name</option>
    </select>
</div>
	<div id="errordiv" style="float:right; margin-right=100px; height: 52px; width: 200px; background-color:#ff6f6f; color:#fff;font-size:20px; border-style:dashed; border-width: 9px;"><p>&nbsp&nbsp&nbspNão há diciplinas!<p></div>
<br><br><br><br>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
{% autoescape off %}
    {{ header }}
{% endautoescape %}
<span id = 'spanAssessment' style="position relativetop:-40px;">Selecione a avaliação:</span><br><br><br>
<select id = 'assessments'></select><br>
<script type="text/javascript">
	$('#main').attr('style', 'height:650px;')
	$('#headerFaculties').prepend('<span>Faculdades: </span>')
    $('#assessments').hide()
    $('#spanAssessment').hide()
	$('#errordiv').hide()
    $('#show').hide()
	
    function loadCourses(idTimePeriod, idCycle, term){
		
        get = new XMLHttpRequest()
        get.open( "GET", 'loadCourses/?' + $.param({idCycle : idCycle, term : term, idTimePeriod : idTimePeriod}), false)
        get.send(null)
        var data = JSON.parse(get.responseText)
        var coursesData = data['courses']
        var div = $('#show')
		var subdiv = $('#subshow')
		var errordiv = $('#errordiv')
        var coursesDiv = new $(document.createElement('div'))
        coursesDiv.attr('id','courses')
        coursesDiv.attr('style', '')
		
	
        div.empty()
		subdiv.empty()
        for (var i in coursesData){
            var checkbox = new $(document.createElement('input'))
            checkbox.attr('type','checkbox')
            checkbox.val(coursesData[i]['idCourse'])
            var span = new $(document.createElement('span'))
            span.text(coursesData[i]['courseCode'] + " - " + coursesData[i]['name'])
            coursesDiv.append(checkbox)
            coursesDiv.append(span)
            coursesDiv.append('<br>')
        }
        div.append(coursesDiv)
	
        var button = new $(document.createElement('button'))
        button.text('Flip all')
	button.attr('class','oval-minibutton')
	button.attr('style','margin-left:20px;')
        button.mousedown(function(){
            var div = $('#courses')
            if (div.children('input').eq(0).attr('checked')){
                div.children('input').each(function(){
                    $(this).attr('checked', false);
                })
            } else {
                div.children('input').each(function(){
                    $(this).attr("checked", true);
                })
            }
        })
	if (coursesData != 0) {
	    subdiv.append(button)
	}
        var button = new $(document.createElement('button'))
        button.text('Gerar')
	button.attr('class','oval-minibutton')
	button.attr('style','margin-left:930px;')
        button.mousedown(function(){
            var div = $('#courses')
            idCourses = new Array()
            for (var i in div.children('input')){
                if (div.children('input').eq(i).attr('checked') == 'checked'){
                    idCourses.push(div.children('input').eq(i).val())
                }
            }
            get = new XMLHttpRequest()
            get.open( "GET", 'generateCourses/?' + $.param({idCourses:JSON.stringify(idCourses), useProfessorsName: $('#useProfessorsName').val(), byOffer:$('#ClassNumberOrProfessor').val(), idTimePeriod:idTimePeriod, idCycle:idCycle, term:term, assessmentNumber: $('#assessments').val(), idFaculty:$('#headerFaculty').val()}), false)
            get.send(null)
            var responseText = get.responseText
            if (responseText.length<100)
                {
                alert(responseText)
                }
            else
                {
                alert('erro')
                window.open(responseText)
                }
        })
			$('#assessments').hide()
			$('#spanAssessment').hide()
			$('#assessments').empty()
			if (coursesData != 0) {
				$('#errordiv').hide()
				$('#main').attr('style', 'min-height:650px;')
				subdiv.append(button)
				assessments = data['assessments']
				for (var i in assessments){
				    var option = new $(document.createElement('option'))
				    option.val(assessments[i])
				    option.text(assessments[i])
				    $('#assessments').append(option)
				}
				$('#assessments').show()
				$('#spanAssessment').show()
				$('#show').show()
				
			}
			else{
					$('#errordiv').show()
			}
    }
    function flipCourses(){
    }

</script>
<div id = 'show' name = 'show' style="position:relative; float:bottom ; top:20px;  background-color:#b1b1b1; color:#ffffff; border:0px solid #666; -moz-box-shadow:0 0 90px 5px #000; -webkit-box-shadow: 0 0 90px #000;"></div>
<div id = 'subshow' name = 'show' style="position:relative; float:bottom ; margin-top:60px;"></div>

</div>

{% endblock %}
