<html>
<head>
<title>folha otica</title>
</head>
<body>
    {% autoescape off %}
        {{ divs.divs }}
    {% endautoescape %}
    <div id= "botaoNovo" style="position:absolute; top:50px; left:0px ">
        <button type="button" onmousedown="novo()" style = "width: 200px;">Nova Codificacao</button>  
    </div>
    <div id= "botaoEditar" style="position:absolute; top:50px; left:200px">
        <button type="button" onmousedown="editar()" style = "width: 200px;">Editar Codificacao</button>
    </div>
    <div id="botaoAtualCod" style = 'position:absolute; top:70px; left:1000px;'>
    </div>
    <div id="botaoNovaCod" style = 'position:absolute; top:70px; left:100px;'>
    </div>
    
    <form id='oferecimentos' name='oferecimentos'>
        <div id='nomeCodificacao'>
        </div>
        <span id = 'novoSpan' style="position:absolute; top:50px; left:200px;;">Codificação Nova</span>
        <div id = 'NovaCodificacao' style="position:absolute; top:120px; left:200px; height:500px;width:500px;overflow:auto; border:0.5px solid #000000;">
        </div>
    </form>
    <form id='oferecimentosAtuais' name='oferecimentosAtuais'>
        <div id='nomeCodificacaoAtual'>
        </div>
        <span id = 'atualSpan' style="position:absolute; top:50px; left:1000px;">Codificação Atual</span>
        <div id = 'AtualCodificacao' style="position:absolute; top:120px; left:1000px; height:500px;width:500px;overflow:auto; border:0.5px solid #000000;">
        </div>
    </form>
</body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
<script type="text/javascript">
    $('#AtualCodificacao').hide()
    $('#NovaCodificacao').hide()
    $('#atualSpan').hide()
    $('#novoSpan').hide()
    $("#botaoNovo").hide()
    $("#botaoEditar").hide()
    {% autoescape off %}
        {{ divs.js }}
    {% endautoescape %}
      
    function editar(){ 
        var periodos = document.getElementById('periodo').value
        $.get("/codificacoes/lista/", {periodos:periodos},function(retorno){
            var object = JSON.parse(retorno)
            var linha = ''
            linha = "<span class='etiquetaFormulario'>codificacoes: </span><select style='width: 200px;' id='nome' name='codificacoes' onChange='cod(); mostrarCodificacao(); funcUni()' ><option value= 0 > </option>";
            for (var cod in object){
                linha = linha + "<option value='" + String(object[cod]["nome"]) + "'>" + String(object[cod]["nome"]) + "</option>";               
            }
            linha = linha + "</select>"
            $('#botaoEditar').html(linha)
            $('#botaoNovo').hide()
        });
    }
    function novo(){ 
            var linha = "<span class='etiquetaFormulario'>nome: </span><textarea style='width: 100px;height: 50px' id='nome' name='nome' onChange='cod();funcUni()' ></textarea>";
            $('#botaoNovo').html(linha)
            $('#botaoEditar').hide()
    }
    function cod(){
        var linha =''
        linha = '<input name = "nomeCod" id= "nomeCod" value = "'+document.getElementById('nome').value+'"type="hidden"  style="position:absolute; left:200px;">'+document.getElementById('nome').value+'</input>'
        $('#nomeCodificacao').html(linha)
        linha = '<input name = "nomeCod" id= "nomeCod" value = "'+document.getElementById('nome').value+'"type="hidden"  style="position:absolute; left:200px;"></input>'
        $('#nomeCodificacaoAtual').html(linha)  
        $('#botaoNovo').hide()
        $('#per').hide()
        mostrarCodificacao() 
        
    }
  
    function possiveisOferecimentos(){
        var idPeriodo = document.getElementById("periodo").value
        var idHab = document.getElementById("habilitacao").value
        var ordem = document.getElementById("ordem").value
        $.get("/codificacoes/possiveisOferecimentos/", {habilitacao : idHab,periodo: idPeriodo,ordem:ordem},function(retorno){
            var object = JSON.parse(retorno)
            var linha = "<button type='button' onmousedown='toggleChecked(\"#NovaCodificacao\")' style = 'width: 200px'>Selecionar Tudo</button> <button type='button' onmousedown='acrescentarOferecimento()' style = 'width: 300px;position:absolute;left:200px;'>Acrescentar Oferecimento</button>"
            $('#botaoNovaCod').html(linha)
            $('#botaoNovaCod').show()
            linha = ''
            for (var disc in object){
                linha = linha + "<input type='checkbox' onChange=toggleChecked(\"#Novo"+object[disc]['idDisciplina__sigla']+"\")> "+ object[disc]['idDisciplina__sigla']+":"+object[disc]['idDisciplina__nome'] +"</input><br><div id = Novo"+object[disc]['idDisciplina__sigla']+">"
                for (var ofe in object[disc]['oferecimentos']){
                    linha = linha + "<input name= Novo:" + object[disc]['idDisciplina__sigla'] +":"+String(object[disc]['oferecimentos'][ofe]["turma"]) + ":" + String(object[disc]['oferecimentos'][ofe]["idOferecimento"]) +" id= Novo:" + object[disc]['idDisciplina__sigla'] +":"+String(object[disc]['oferecimentos'][ofe]["turma"]) +":"+ String(object[disc]['oferecimentos'][ofe]["idOferecimento"]) +" type='checkbox' value='" + String(object[disc]['oferecimentos'][ofe]["idOferecimento"]) + "' style = 'font-size:10px; position:absolute; left:20px;'> </input><span style = 'font-size:10px; position:absolute; left:40px;' >Turma: " +String(object[disc]['oferecimentos'][ofe]["turma"])+ " - Professor(a) - "+String(object[disc]['oferecimentos'][ofe]["idDocente__nome"])+"</span><br>";    
                }
                linha = linha + "</div>"
            }
            $('#NovaCodificacao').show()
            $('#NovaCodificacao').html(linha)
            $('#novoSpan').show()
            mostrarCodificacao()
        });
    }
    function toggleChecked(div) {
        $(div).each( function() {
            var checkbox = $(this).find(':checkbox');
            checkbox.attr('checked', !checkbox.attr('checked'));

        })
    }
    function mostrarCodificacao(){
        var nome = document.getElementById('nomeCod').value
        $.get("/codificacoes/listarOferecimentos/", {'nome':nome},function (retorno){
            var object = JSON.parse(retorno)
            var linha = "<button type='button' onmousedown='toggleChecked(\"#AtualCodificacao\")' style = 'width: 200px;'>Selecionar Tudo</button> <button type='button' onmousedown='deletarOferecimento()' style = 'width: 200px;position:absolute;left:200px;'>Deletar Oferecimento</button> "//<button type='button' onmousedown='reordenarOferecimento()' style = 'width: 200px;position:absolute;left:400px;'>Reordenar</button>"
            $('#botaoAtualCod').html(linha)
            $('#botaoAtualCod').show()
            linha = ''
            for (var disc in object){
                linha = linha + "<input type='checkbox' onChange=toggleChecked(\"#Atual"+object[disc]['idOferecimento__idDisciplina__sigla']+"\")>"+object[disc]['idOferecimento__idDisciplina__sigla']+":"+object[disc]['idOferecimento__idDisciplina__nome']+"</input><br><div id = Atual"+object[disc]['idOferecimento__idDisciplina__sigla']+">"
                for (var ofe in object[disc]['oferecimentos']){
                    linha = linha + "<input name= Atual:" + object[disc]['idOferecimento__idDisciplina__sigla'] +":"+String(object[disc]['oferecimentos'][ofe]["idOferecimento__turma"]) +":"+ String(object[disc]['oferecimentos'][ofe]["idOferecimento"]) + " id= Atual:" + object[disc]['idOferecimento__idDisciplina__sigla'] +":"+String(object[disc]['oferecimentos'][ofe]["idOferecimento__turma"]) +":"+ String(object[disc]['oferecimentos'][ofe]["idOferecimento"]) + " type='checkbox' value='" + String(object[disc]['oferecimentos'][ofe]["idOferecimento"]) + "' style = 'font-size:10px; position:absolute; left:20px;'> </input><span style = 'font-size:10px; position:absolute; left:40px;' >Turma: " +String(object[disc]['oferecimentos'][ofe]["idOferecimento__turma"])+ " - Professor(a) - "+String(object[disc]['oferecimentos'][ofe]["idOferecimento__idDocente__nome"])+"</span><span style = 'font-size:10px; position:absolute; left:460px;'>"+String(object[disc]['oferecimentos'][ofe]['codigo'])+"</span><br>";    
                }
                linha = linha + "</div>"
            }
            $('#AtualCodificacao').show()
            $('#AtualCodificacao').html(linha)
            $('#botaoEditar').hide()
            $('#atualSpan').show()
        });
    }
    function reordenarOferecimento(){
        $.post("/codificacoes/reordenarOferecimentos/", $("#oferecimentosAtuais").serialize(),function (retorno){
            mostrarCodificacao()
        });
    }
    function deletarOferecimento(){
        $.post("/codificacoes/deletarOferecimentos/", $("#oferecimentosAtuais").serialize(),function (retorno){
            mostrarCodificacao()
        });
    }
    function acrescentarOferecimento(){
        $.post("/codificacoes/acrescentarOferecimentos/", $("#oferecimentos").serialize(),function (retorno){
            mostrarCodificacao()
        });
    }
</script>
</html>
